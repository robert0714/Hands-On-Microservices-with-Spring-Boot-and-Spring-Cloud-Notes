# Deploying Istio in a Kubernetes cluster
## Setting up access to Istio services
### Minikube
[reference](https://argoproj.github.io/argo-rollouts/getting-started/setup/)

1.Istio needs 8192MB of memory,4 CPUs .Start minikube with 16384 MB of memory and 4 CPUs.
```
minikube -p lab  start --memory=8192mb --cpus=4
```
2. Install istio
```
minikube -p lab  addons enable istio-provisioner
minikube -p lab  addons enable istio
```
If you don’t have enough RAM allocated to the minikube virtual machine, the following errors could occur:
-  image pull failures
-  healthcheck timeout failures
-  kubectl failures on the host
-  general network instability of the virtual machine and the host
-  complete lock-up of the virtual machine
-  host NMI watchdog reboots
 
      One effective way to monitor memory usage in minikube is to ssh into the minikube virtual machine and from that prompt run the top command:
    ```
    $ minikube ssh

    $ top
    GiB Mem : 12.4/15.7
    ```
    This shows 12.4GiB used of an available 15.7 GiB RAM within the virtual machine. This data was generated with the VMWare Fusion hypervisor on a Macbook Pro 13” with 16GiB RAM running Istio 1.2 with bookinfo installed.

3. Label the default namespace to enable istio sidecar injection for the namespace
```
kubectl label namespace default istio-injection=enabled
```
## An added bonus from using the minikube tunnel command
[reference](https://istio.io/latest/docs/setup/platform-setup/minikube/)

(Optional, recommended) If you want minikube to provide a load balancer for use by Istio, you can use the minikube tunnel feature. Run this command in a different terminal, because the minikube tunnel feature will block your terminal to output diagnostic information about the network:
```
$ minikube tunnel
```
While running minikube tunnel, the istio-ingressgateway Service will now have an external IP which can be retrieved via kubectl:
```bash
$ kubectl get svc -n istio-system istio-ingressgateway
NAME                   TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                            AGE
istio-ingressgateway   LoadBalancer   10.100.136.45   10.100.136.45   15020:31711/TCP,80:31298/TCP....   7d22h

```

Sometimes minikube does not clean up the tunnel network properly. To force a proper cleanup:
```
$ minikube tunnel --cleanup
```
